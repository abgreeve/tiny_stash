define("tiny_stash/ui",["exports","core/modal_factory","core/modal_events","core/templates","core/ajax","editor_tiny/options"],(function(_exports,_modal_factory,_modal_events,_templates,_ajax,_options){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny stash UI.
   *
   * @module      tiny_stash/ui
   * @copyright   2023 Adrian Greeve <adriangreeve.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax);_exports.handleAction=editor=>{displayDialogue(editor)};const displayDialogue=async editor=>{let contextid=(0,_options.getContextId)(editor),data=await getAllDropData(contextid);const modalPromises=await _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("tiny_stash/drop-code-selector",data),large:!0});modalPromises.show();const $root=await modalPromises.getRoot(),root=$root[0];let savedata={};$root.on(_modal_events.default.hidden,(()=>{let codearea=document.getElementsByClassName("tiny-stash-item-code");savedata.codearea=codearea[0].innerText,modalPromises.destroy()})),$root.on(_modal_events.default.shown,(()=>{})),root.addEventListener("click",(event=>{let element=event.target,elementtype=element.dataset.type,codearea=document.getElementsByClassName("tiny-stash-item-code");if("OPTION"===element.nodeName&&"item"==elementtype){let dropcode='[stashdrop secret="'+element.dataset.hash+'" text="Pick up!" image]';codearea[0].innerText=dropcode}"BUTTON"===element.nodeName&&"save"==element.dataset.action&&editor.execCommand("mceInsertContent",!1,savedata.codearea)}))},getAllDropData=contextid=>_ajax.default.call([{methodname:"block_stash_get_all_drops",args:{contextid:contextid}}])[0]}));

//# sourceMappingURL=ui.min.js.map