define("tiny_stash/additem",["exports","core/fragment","core/templates","jquery","core/ajax"],(function(_exports,_fragment,_templates,_jquery,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Add a new item internal
   *
   * @copyright  2023 Adrian Greeve <adriangreeve.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.removeChildren=_exports.init=_exports.Status=void 0,_fragment=_interopRequireDefault(_fragment),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);let CourseId=0,Status="Clear";_exports.Status=Status;_exports.init=(courseid,contextid)=>{CourseId=courseid;let areanode=document.querySelector(".tiny-stash-next-slide");_fragment.default.loadFragment("tiny_stash","add_item_form",contextid,{courseid:courseid}).then(((html,js)=>{_templates.default.appendNodeContents(areanode,html,js)})),_templates.default.render("tiny_stash/local/footers/add-item-footer",{}).then(((html,js)=>{let modalfooter=document.querySelector(".modal-footer");removeChildren(modalfooter),_templates.default.appendNodeContents(modalfooter,html,js),addFooterListeners()}))};const removeChildren=node=>{for(;node.firstChild;)node.removeChild(node.lastChild)};_exports.removeChildren=removeChildren;const addFooterListeners=()=>{document.querySelector('button[data-action="back"]').addEventListener("click",(e=>{shiftBack(e)})),document.querySelector('button[data-action="add"]').addEventListener("click",(e=>{saveItem(e)}))},shiftBack=e=>{e.preventDefault(),(0,_jquery.default)(".carousel").carousel("prev"),(0,_jquery.default)(".carousel").carousel("pause");let areanode=document.querySelector(".tiny-stash-next-slide");removeChildren(areanode),_templates.default.render("tiny_stash/local/footers/main-footer",{}).then(((html,js)=>{let modalfooter=document.querySelector(".modal-footer");removeChildren(modalfooter),_templates.default.appendNodeContents(modalfooter,html,js)}))},saveItem=event=>{let formdata=document.querySelector(".tiny-stash-next-slide form"),submitdata={itemname:formdata.querySelector("#id_name").value,scarceitem:formdata.querySelector("#id_scarceitem").checked,amountlimit:formdata.querySelector("#id_amountlimit").value?formdata.querySelector("#id_amountlimit").value:0,itemimage:formdata.querySelector("#id_image").value,description:formdata.querySelector("#id_detail_text").value};validateForm(submitdata)&&createItem(submitdata).then((()=>{_exports.Status=Status="Saved",shiftBack(event)}))},validateForm=formdata=>(window.console.log(formdata),!0),createItem=itemdata=>_ajax.default.call([{methodname:"block_stash_add_item",args:{courseid:CourseId,itemname:itemdata.itemname,scarceitem:itemdata.scarceitem,amountlimit:itemdata.amountlimit,itemimage:itemdata.itemimage,description:itemdata.description}}])[0]}));

//# sourceMappingURL=additem.min.js.map