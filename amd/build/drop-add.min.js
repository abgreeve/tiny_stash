define("tiny_stash/drop-add",["exports","jquery","core/templates","tiny_stash/options","tiny_stash/webservice-calls"],(function(_exports,_jquery,_templates,_options,WebService){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * The internal workings of the add location dialogue.
   *
   * @copyright  2023 Adrian Greeve <adriangreeve.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setStatus=_exports.removeChildren=_exports.init=_exports.getStatus=_exports.Status=_exports.SavedIndex=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),WebService=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(WebService);let ItemsData={},Editor={},SavedIndex="";_exports.SavedIndex=SavedIndex;let Status="Clear";_exports.Status=Status;_exports.init=(itemsData,editor)=>{ItemsData=itemsData,Editor=editor;let areanode=document.querySelector(".tiny-stash-location"),data={items:[]};for(let item of Object.entries(ItemsData))data.items.push({id:item[1].id,name:item[1].name});1===data.items.length&&(data.oneonly=!0),areanode&&_templates.default.render("tiny_stash/stash-drop-form",data).then(((html,js)=>{_templates.default.appendNodeContents(areanode,html,js)})),_templates.default.render("tiny_stash/local/footers/add-drop-footer",{}).then(((html,js)=>{let modalfooter=document.querySelector(".modal-footer");addFormListeners(),removeChildren(modalfooter),_templates.default.appendNodeContents(modalfooter,html,js),addFooterListeners()}))};const addFormListeners=()=>{const suppliesnode=document.querySelector(".location-supplies"),unlimitedflag=document.querySelector("#supplyunlimited"),pickupinterval=document.querySelector(".pickupinterval"),intervalnumber=document.querySelector(".intervalnumber"),updateFields=()=>{suppliesnode.value>1||unlimitedflag.checked?(pickupinterval.disabled=!1,intervalnumber.disabled=!1):(pickupinterval.disabled=!0,intervalnumber.disabled=!0)},addListener=node=>{node.addEventListener("change",updateFields),node.addEventListener("keyup",updateFields)};addListener(suppliesnode),addListener(unlimitedflag)};_exports.setStatus=newstatus=>{_exports.Status=Status=newstatus};_exports.getStatus=()=>Status;const removeChildren=node=>{for(;node.firstChild;)node.removeChild(node.lastChild)};_exports.removeChildren=removeChildren;const addFooterListeners=()=>{document.querySelector('button[data-action="back"]').addEventListener("click",(e=>{shiftBack(e)})),document.querySelector('button[data-action="add"]').addEventListener("click",(e=>{(e=>{let itemnode=document.querySelector(".stash-item"),itemvalue=0;itemvalue="id"in itemnode.dataset?itemnode.dataset.id:itemnode.options[itemnode.selectedIndex].value;let locationnode=document.querySelector(".location-name").value,suppliesnode=document.querySelector(".location-supplies").value,suppliesunlimitednode=document.querySelector("#supplyunlimited").checked,intervalnumber=document.querySelector(".intervalnumber").value,pickupintervalnode=document.querySelector(".pickupinterval");suppliesunlimitednode&&(suppliesnode=0);let data={itemid:itemvalue,location:locationnode,supplies:suppliesnode,unlimited:suppliesunlimitednode,pickupinterval:intervalnumber*pickupintervalnode.options[pickupintervalnode.selectedIndex].value},courseid=(0,_options.getCourseId)(Editor);WebService.createDrop(courseid,data).then((hashcode=>{_exports.SavedIndex=SavedIndex=hashcode,_exports.Status=Status="Saved",shiftBack(e)}))})(e)}))},shiftBack=e=>{e.preventDefault(),(0,_jquery.default)(".carousel").carousel(0),(0,_jquery.default)(".carousel").carousel("pause");let areanode=document.querySelector(".tiny-stash-location");removeChildren(areanode),_templates.default.render("tiny_stash/local/footers/main-footer",{}).then(((html,js)=>{let modalfooter=document.querySelector(".modal-footer");removeChildren(modalfooter),_templates.default.appendNodeContents(modalfooter,html,js)}))}}));

//# sourceMappingURL=drop-add.min.js.map