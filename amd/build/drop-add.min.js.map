{"version":3,"file":"drop-add.min.js","sources":["../src/drop-add.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * description\n *\n * @copyright  2023 Adrian Greeve <adriangreeve.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport {getContextId} from 'editor_tiny/options';\n\nlet ItemsData = {};\nlet Editor = {};\n\nexport const init = (itemsData, editor) => {\n    ItemsData = itemsData;\n    Editor = editor;\n    let contextid = getContextId(Editor);\n    window.console.log(contextid);\n    let areanode = document.querySelector('.tiny-stash-next-slide');\n    // format items for export to the template.\n    let data = {items: []};\n    for (let [index, item] of Object.entries(ItemsData)) {\n        window.console.log(index);\n        // window.console.log(item);\n        data.items.push({id: item.id, name: item.name});\n    }\n\n    if (areanode) {\n        Templates.render('tiny_stash/stash-drop-form', data).then((html, js) => {\n            Templates.appendNodeContents(areanode, html, js);\n        });\n    }\n\n    Templates.render('tiny_stash/local/footers/add-drop-footer', {}).then((html, js) => {\n        let modalfooter = document.querySelector('.modal-footer');\n        // Remove existing buttons.\n        removeChildren(modalfooter);\n        Templates.appendNodeContents(modalfooter, html, js);\n        addFooterListeners();\n    });\n};\n\nconst removeChildren = (node) => {\n    while (node.firstChild) {\n        node.removeChild(node.lastChild);\n    }\n};\n\nconst saveLocation = () => {\n    let itemnode = document.querySelector('.stash-item');\n    let itemvalue = itemnode.options[itemnode.selectedIndex].value;\n    let locationnode = document.querySelector('.location-name').value;\n    let suppliesnode = document.querySelector('.location-supplies').value;\n    let suppliesunlimitednode = document.querySelector('#supplyunlimited').checked;\n    let intervalnumber = document.querySelector('.intervalnumber').value;\n    let pickupintervalnode = document.querySelector('.pickupinterval');\n    let pickupinterval = pickupintervalnode.options[pickupintervalnode.selectedIndex].value;\n    let data = {\n        itemid: itemvalue,\n        location: locationnode,\n        supplies: suppliesnode,\n        unlimited: suppliesunlimitednode,\n        intervalnumber: intervalnumber,\n        pickupinterval: pickupinterval\n    };\n    window.console.log(data);\n};\n\nconst addFooterListeners = () => {\n    let backbutton = document.querySelector('button[data-action=\"back\"]');\n    backbutton.addEventListener('click', (e) => {\n        e.preventDefault();\n        $('.carousel').carousel('prev');\n        $('.carousel').carousel('pause');\n        // Clear this page.\n        let areanode = document.querySelector('.tiny-stash-next-slide');\n        removeChildren(areanode);\n        // Replace footer.\n        Templates.render('tiny_stash/local/footers/main-footer', {}).then((html, js) => {\n            let modalfooter = document.querySelector('.modal-footer');\n            // Remove existing buttons.\n            removeChildren(modalfooter);\n            Templates.appendNodeContents(modalfooter, html, js);\n        });\n    });\n    let addbutton = document.querySelector('button[data-action=\"add\"]');\n    addbutton.addEventListener('click', () => {\n        window.console.log('Save this drop!');\n        saveLocation();\n    });\n};\n"],"names":["ItemsData","Editor","itemsData","editor","contextid","window","console","log","areanode","document","querySelector","data","items","index","item","Object","entries","push","id","name","render","then","html","js","appendNodeContents","modalfooter","removeChildren","addFooterListeners","node","firstChild","removeChild","lastChild","addEventListener","e","preventDefault","carousel","itemnode","itemvalue","options","selectedIndex","value","locationnode","suppliesnode","suppliesunlimitednode","checked","intervalnumber","pickupintervalnode","itemid","location","supplies","unlimited","pickupinterval","saveLocation"],"mappings":";;;;;;4KA0BIA,UAAY,GACZC,OAAS,iBAEO,CAACC,UAAWC,UAC5BH,UAAYE,UACZD,OAASE,WACLC,WAAY,yBAAaH,QAC7BI,OAAOC,QAAQC,IAAIH,eACfI,SAAWC,SAASC,cAAc,0BAElCC,KAAO,CAACC,MAAO,QACd,IAAKC,MAAOC,QAASC,OAAOC,QAAQhB,WACrCK,OAAOC,QAAQC,IAAIM,OAEnBF,KAAKC,MAAMK,KAAK,CAACC,GAAIJ,KAAKI,GAAIC,KAAML,KAAKK,OAGzCX,6BACUY,OAAO,6BAA8BT,MAAMU,MAAK,CAACC,KAAMC,yBACnDC,mBAAmBhB,SAAUc,KAAMC,0BAI3CH,OAAO,2CAA4C,IAAIC,MAAK,CAACC,KAAMC,UACrEE,YAAchB,SAASC,cAAc,iBAEzCgB,eAAeD,gCACLD,mBAAmBC,YAAaH,KAAMC,IAChDI,+BAIFD,eAAkBE,YACbA,KAAKC,YACRD,KAAKE,YAAYF,KAAKG,YAwBxBJ,mBAAqB,KACNlB,SAASC,cAAc,8BAC7BsB,iBAAiB,SAAUC,IAClCA,EAAEC,qCACA,aAAaC,SAAS,4BACtB,aAAaA,SAAS,aAEpB3B,SAAWC,SAASC,cAAc,0BACtCgB,eAAelB,6BAELY,OAAO,uCAAwC,IAAIC,MAAK,CAACC,KAAMC,UACjEE,YAAchB,SAASC,cAAc,iBAEzCgB,eAAeD,gCACLD,mBAAmBC,YAAaH,KAAMC,UAGxCd,SAASC,cAAc,6BAC7BsB,iBAAiB,SAAS,KAChC3B,OAAOC,QAAQC,IAAI,mBAvCN,UACb6B,SAAW3B,SAASC,cAAc,eAClC2B,UAAYD,SAASE,QAAQF,SAASG,eAAeC,MACrDC,aAAehC,SAASC,cAAc,kBAAkB8B,MACxDE,aAAejC,SAASC,cAAc,sBAAsB8B,MAC5DG,sBAAwBlC,SAASC,cAAc,oBAAoBkC,QACnEC,eAAiBpC,SAASC,cAAc,mBAAmB8B,MAC3DM,mBAAqBrC,SAASC,cAAc,mBAE5CC,KAAO,CACPoC,OAAQV,UACRW,SAAUP,aACVQ,SAAUP,aACVQ,UAAWP,sBACXE,eAAgBA,eAChBM,eAPiBL,mBAAmBR,QAAQQ,mBAAmBP,eAAeC,OASlFnC,OAAOC,QAAQC,IAAII,OAuBfyC"}