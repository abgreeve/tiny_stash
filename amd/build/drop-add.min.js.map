{"version":3,"file":"drop-add.min.js","sources":["../src/drop-add.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * The internal workings of the add location dialogue.\n *\n * @copyright  2023 Adrian Greeve <adriangreeve.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport {getCourseId} from 'tiny_stash/options';\n\nlet ItemsData = {};\nlet Editor = {};\nexport let Status = 'Clear';\n\n/**\n * Initialisation function for the drop add modal.\n *\n * @param {object} itemsData - The data for the items.\n * @param {TinyMCE} editor - The editor object.\n */\nexport const init = (itemsData, editor) => {\n    ItemsData = itemsData;\n    Editor = editor;\n    let areanode = document.querySelector('.tiny-stash-next-slide');\n    // format items for export to the template.\n    let data = {items: []};\n    for (let item of Object.entries(ItemsData)) {\n        data.items.push({id: item[1].id, name: item[1].name});\n    }\n\n    if (areanode) {\n        Templates.render('tiny_stash/stash-drop-form', data).then((html, js) => {\n            Templates.appendNodeContents(areanode, html, js);\n        });\n    }\n\n    Templates.render('tiny_stash/local/footers/add-drop-footer', {}).then((html, js) => {\n        let modalfooter = document.querySelector('.modal-footer');\n        // Remove existing buttons.\n        removeChildren(modalfooter);\n        Templates.appendNodeContents(modalfooter, html, js);\n        addFooterListeners();\n    });\n};\n\n/**\n * Remove all the children from a node.\n *\n * @param {node} node - The node to remove the children from.\n */\nexport const removeChildren = (node) => {\n    while (node.firstChild) {\n        node.removeChild(node.lastChild);\n    }\n};\n\n/**\n * Save the drop.\n *\n * @param {event} e - The related event.\n */\nconst saveLocation = (e) => {\n    let itemnode = document.querySelector('.stash-item');\n    let itemvalue = itemnode.options[itemnode.selectedIndex].value;\n    let locationnode = document.querySelector('.location-name').value;\n    let suppliesnode = document.querySelector('.location-supplies').value;\n    let suppliesunlimitednode = document.querySelector('#supplyunlimited').checked;\n    let intervalnumber = document.querySelector('.intervalnumber').value;\n    let pickupintervalnode = document.querySelector('.pickupinterval');\n    let pickupinterval = pickupintervalnode.options[pickupintervalnode.selectedIndex].value;\n    if (suppliesunlimitednode) {\n        suppliesnode = 0;\n    }\n    let data = {\n        itemid: itemvalue,\n        location: locationnode,\n        supplies: suppliesnode,\n        unlimited: suppliesunlimitednode,\n        intervalnumber: intervalnumber,\n        pickupinterval: pickupinterval\n    };\n    let courseid = getCourseId(Editor);\n    createDrop(courseid, data).then(() => {\n        Status = 'Saved';\n        shiftBack(e);\n    });\n};\n\n/**\n * Add listeners to the footer buttons.\n */\nconst addFooterListeners = () => {\n    let backbutton = document.querySelector('button[data-action=\"back\"]');\n    backbutton.addEventListener('click', (e) => {\n        shiftBack(e);\n    });\n    let addbutton = document.querySelector('button[data-action=\"add\"]');\n    addbutton.addEventListener('click', (e) => {\n        saveLocation(e);\n    });\n};\n\n/**\n * Shift the carousel back.\n *\n * @param {event} e - The related event.\n */\nconst shiftBack = (e) => {\n    e.preventDefault();\n    $('.carousel').carousel('prev');\n    $('.carousel').carousel('pause');\n    // Clear this page.\n    let areanode = document.querySelector('.tiny-stash-next-slide');\n    removeChildren(areanode);\n    // Replace footer.\n    Templates.render('tiny_stash/local/footers/main-footer', {}).then((html, js) => {\n        let modalfooter = document.querySelector('.modal-footer');\n        // Remove existing buttons.\n        removeChildren(modalfooter);\n        Templates.appendNodeContents(modalfooter, html, js);\n    });\n};\n\n/**\n * Create the drop.\n *\n * @param {number} courseid - The course id.\n * @param {object} dropdata - The data for the drop.\n */\nconst createDrop = (courseid, dropdata) => Ajax.call([{\n    methodname: 'block_stash_add_drop',\n    args: {\n        courseid: courseid,\n        itemid: dropdata.itemid,\n        name: dropdata.location,\n        maxpickup: dropdata.supplies,\n        pickupinterval: dropdata.pickupinterval\n    }\n}])[0];\n"],"names":["ItemsData","Editor","Status","itemsData","editor","areanode","document","querySelector","data","items","item","Object","entries","push","id","name","render","then","html","js","appendNodeContents","modalfooter","removeChildren","addFooterListeners","node","firstChild","removeChild","lastChild","addEventListener","e","shiftBack","itemnode","itemvalue","options","selectedIndex","value","locationnode","suppliesnode","suppliesunlimitednode","checked","intervalnumber","pickupintervalnode","itemid","location","supplies","unlimited","pickupinterval","courseid","createDrop","saveLocation","preventDefault","carousel","dropdata","Ajax","call","methodname","args","maxpickup"],"mappings":";;;;;;wPA2BIA,UAAY,GACZC,OAAS,GACFC,OAAS,6CAQA,CAACC,UAAWC,UAC5BJ,UAAYG,UACZF,OAASG,WACLC,SAAWC,SAASC,cAAc,0BAElCC,KAAO,CAACC,MAAO,QACd,IAAIC,QAAQC,OAAOC,QAAQZ,WAC5BQ,KAAKC,MAAMI,KAAK,CAACC,GAAIJ,KAAK,GAAGI,GAAIC,KAAML,KAAK,GAAGK,OAG/CV,6BACUW,OAAO,6BAA8BR,MAAMS,MAAK,CAACC,KAAMC,yBACnDC,mBAAmBf,SAAUa,KAAMC,0BAI3CH,OAAO,2CAA4C,IAAIC,MAAK,CAACC,KAAMC,UACrEE,YAAcf,SAASC,cAAc,iBAEzCe,eAAeD,gCACLD,mBAAmBC,YAAaH,KAAMC,IAChDI,+BASKD,eAAkBE,YACpBA,KAAKC,YACRD,KAAKE,YAAYF,KAAKG,yDAuCxBJ,mBAAqB,KACNjB,SAASC,cAAc,8BAC7BqB,iBAAiB,SAAUC,IAClCC,UAAUD,MAEEvB,SAASC,cAAc,6BAC7BqB,iBAAiB,SAAUC,IApCnBA,CAAAA,QACdE,SAAWzB,SAASC,cAAc,eAClCyB,UAAYD,SAASE,QAAQF,SAASG,eAAeC,MACrDC,aAAe9B,SAASC,cAAc,kBAAkB4B,MACxDE,aAAe/B,SAASC,cAAc,sBAAsB4B,MAC5DG,sBAAwBhC,SAASC,cAAc,oBAAoBgC,QACnEC,eAAiBlC,SAASC,cAAc,mBAAmB4B,MAC3DM,mBAAqBnC,SAASC,cAAc,mBAE5C+B,wBACAD,aAAe,OAEf7B,KAAO,CACPkC,OAAQV,UACRW,SAAUP,aACVQ,SAAUP,aACVQ,UAAWP,sBACXE,eAAgBA,eAChBM,eAViBL,mBAAmBR,QAAQQ,mBAAmBP,eAAeC,OAY9EY,UAAW,wBAAY9C,QAC3B+C,WAAWD,SAAUvC,MAAMS,MAAK,qBAC5Bf,OAAS,QACT4B,UAAUD,OAcVoB,CAAapB,OASfC,UAAaD,IACfA,EAAEqB,qCACA,aAAaC,SAAS,4BACtB,aAAaA,SAAS,aAEpB9C,SAAWC,SAASC,cAAc,0BACtCe,eAAejB,6BAELW,OAAO,uCAAwC,IAAIC,MAAK,CAACC,KAAMC,UACjEE,YAAcf,SAASC,cAAc,iBAEzCe,eAAeD,gCACLD,mBAAmBC,YAAaH,KAAMC,QAUlD6B,WAAa,CAACD,SAAUK,WAAaC,cAAKC,KAAK,CAAC,CAClDC,WAAY,uBACZC,KAAM,CACFT,SAAUA,SACVL,OAAQU,SAASV,OACjB3B,KAAMqC,SAAST,SACfc,UAAWL,SAASR,SACpBE,eAAgBM,SAASN,mBAE7B"}